---
title: "每週一圖作業"
output: html_document
params:
  組員: ["李靜怡"]  
  學號: ["410773095"]
---

#### 環境設定

以下為老師執行時一定會存在的環境設定
```{r basic setup, message=FALSE, echo=TRUE, eval=T}
library(dplyr); library(stringr); library(ggplot2); library(plotly); library(lubridate); library(readr); library(tidyr); library(showtext); library(magrittr)
font_add("QYuan","cwTeXQYuan-Medium.ttf") # 新增字體
showtext_auto(enable=TRUE) #啟用字體
theme_set(theme_classic())
knitr::opts_chunk$set(out.width='80%', fig.asp=.75, fig.align='center', fig.showtext=T)
```

#### 資料處理

此部份在做：

  * 原始Rda資料引入（即引入**dataList**物件）；
  
  * 資料清理成作圖用graphData物件。

請將你最原始的資料連同作業一起上傳到作業上傳網址：  
  * 若「原始資料為網頁下載」，且下載指令寫在data cleaning chunk裡的話，可以不用上傳「資料」。  
  * 若原始資料有很多個檔案，請先引入成data frame並存在「一個」.Rda檔裡上傳（如`example_data.Rda`檔）。  

資料檔引入到進入作圖前的資料處理請寫在下面區塊，分二部份：

  * 資料處理  
  * 作圖用資料物件生成(最後形成作圖資料物件graphData)
  
```{r data cleaning, echo=TRUE, eval=T}
load("X107indicators.Rda")
graphData <- list()

X107indicators[-c(35:36),] %>%
  .[-c(1:2),] %>%
  .[,-2] %>%
  gather(
    -1,
    key = 各級學校, value = 平均每生分攤經費
  ) -> graphData$X107indicators

graphData$X107indicators$學年度 %<>% as.numeric()
graphData$X107indicators$平均每生分攤經費 %<>% as.numeric()
```

#### 繪圖程式

```{r graph, echo=T, eval=T}
graphData$X107indicators %>%
  ggplot()+
  geom_line(
    aes(x=學年度, y=平均每生分攤經費, color = 各級學校) 
  ) +
  scale_color_discrete(breaks = c(
    "大學及學院",
    "專科學校",
    "高中",
    "高職",
    "國中",
    "國小",
    "幼兒園")) +
  labs(title = "各級學校平均每生分攤經費",
       caption = "資料來源: 中華民國統計資訊網",
       subtitle="單位：每人平均經費(元)") +
  theme(
    plot.title = element_text(size = 18, hjust = 0.5),
    plot.caption = element_text(size = 10,
                                color = "#6D6D6D"),
    plot.subtitle = element_text(size = 10),
    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_line(color = "grey90")
  ) +
  geom_hline(aes(yintercept=100000),
             alpha=0.3,linetype="dashed") +
  geom_vline(aes(xintercept=97),
             alpha=0.3,linetype="dashed") +
  scale_y_continuous(
    breaks = c(50000,100000,150000,200000),
    labels = c("50,000","100,000","150,000","200,000")
  ) ->finalplot
finalplot
```

#### 設計說明
說明想傳達的訊息（必要）及設計想法（非必要）。寫在***之後
*** 
此圖為75學年度以後各級學校平均學生分攤經費(各級學校平均每生分攤經費＝各級學校教育經費支出預算數/各級學校學生人數)，可以看到大學及學院一直都是平均經費最多的，但專科學校的經費和其他各級學校相比並不突出，令人意外的是高職的人均經費長年以來皆高過高中，其原因有待進一步了解。

有趣的是在97學年度，專科學校、高中、國小及幼兒園的人均經費出現了交叉口。

```{r}
finalplot %>%
  ggplotly()
```
